# Generating Grayscale Images
Some baseline human pose estimation (HPE) algorithms work with frame-based data. In order to evaluate those algorithms 
on the DHP19 dataset and compare them with event-based HPE algorithms, events need to be converted to a suitable format.

For this purpose, we use the algorithm [1], which converts set of events into grayscale images using a recurrent 
convolutional neural network. For ease of use, the algorithm is run in a Docker container.

## Step-by-Step Guide

- Install the latest [Nvidia driver](https://github.com/NVIDIA/nvidia-docker/wiki/Frequently-Asked-Questions#how-do-i-install-the-nvidia-driver)
- Install [Docker Engine](https://docs.docker.com/engine/install/ubuntu)
- Install [Nvidia Docker Toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker)
- Download the `S%d_%d_%d.mat` files containing the preprocessed DHP19 events to a desired folder (they are located in 
`//10.240.102.11/human_pose_estimation/Datasets/DHP19/Preprocessed_data`; see /hep-core/evaluation/dhp19/README.md).
- Create an `output` folder for storing the grayscale frames generated by e2vid
- Be sure to have generated ssh keys for access to this repository (see this [guide](https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)
for generating the keys and this [guide](https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account) 
for adding the keys to your github account)
- Download this repository and build the Docker image
    ```shell
    $ cd /hpe-core/evaluation/dhp19/e2vid
    $ docker build -t hpe-core --build-arg ssh_prv_key="$(cat ~/.ssh/id_ed25519)" --build-arg ssh_pub_key="$(cat ~/.ssh/id_ed25519.pub)" - < Dockerfile
    ```
  (the public and private ssh keys are supposed to be named `id_ed25519.pub` and `id_ed25519` respectively, and be stored
in the `~/.ssh` directory)
- run the Docker container with
    ```shell
    $ docker run -it -v /path/to/mat/files:/data --runtime=nvidia <docker_image_id>
    ```
- when inside the Docker container, create grayscale frames by running e2vid
    ```shell
    $ ./create_grayscale_frames.sh -i <input_mat_file> -o <output_folder_name>
    ```
The generated frames will be located in folder `output_folder_name`.

## References
[1] - Rebecq, Henri, et al. "High speed and high dynamic range video with an event camera." IEEE transactions on pattern analysis and machine intelligence (2019).